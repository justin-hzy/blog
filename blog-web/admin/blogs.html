<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台</title>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <script src="../static/js/const.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="../static/css/me.css">
</head>
<!-- style="display: none;" -->
<body>
    <!-- 导航 -->
    <nav class="ui inverted attached segment m-padded-tb-mini m-shadow-samll">
        <div class="ui container">
            <div class="ui inverted secondary menu">
                <h2 class="ui teal header item">管理后台</h2>
                <a href="http://127.0.0.1:8000/admin/blogs.html" class="active m-item item m-mobile-hide"><i class="home icon"></i>博客</a>
                <a href="http://127.0.0.1:8000/admin/types.html" class="m-item item m-mobile-hide"><i class="idea icon"></i>分类</a>
                <a href="http://127.0.0.1:8000/admin/tags.html" class=" m-item item m-mobile-hide"><i class="tags icon"></i>标签</a>
                <div class="right m-item m-mobile-hide menu">
                    <div class="ui dropdown item">
                        <div class="text">
                            <img class="ui avatar image" src="https://unsplash.it/100/100?image=1005">
                                何子毅
                            </img>
                        </div>
                        <i class="dropdown icon"></i>
                        <div class="menu">
                            <a href="#" class="item">注销</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a href="" class="ui menu toggle black icon button m-right-top m-mobile-show">
            <i class="sidebar icon">
                
            </i>
        </a>
    </nav>

    <!-- 二级导航 -->
    <div class="ui attached pointing menu">
        <div class="ui container">
            <div class="right menu">
                <a href="#" class="item">发布</a>
                <a href="#" class="active teal item">列表</a>
            </div>
        </div>
    </div>
<!--详情页开始-->
    <!-- 中间内容 -->
    <div class = "m-container-small m-padded-tb-big">
        <div class="ui container">
            <form action="#" method="POST" class="ui secondary segment form">
                <div class="inline fields">
                    <div class="field">
                        <input type="text" name="title" placeholder="标题">
                    </div>
                    <div id="typeField" class="field">
                        <div class="ui selection dropdown">
                            <input type="hiden" name="type">
                            <i id="typeDropdown" class="dropdown icon"></i>
                            <div class="default text">分类</div>
                            <div id="typeMenu" class="menu">
                               <!--  <div class="item" data-value="1">错误日志</div>
                                <div class="item" data-value="2">开发者手册</div> -->
                            </div>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui checkbox">
                            <input type="checkbox" id="recommend" name="recommend">
                            <label for="recommend">推荐</label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui mini teal basic button" onclick="search()">
                            <i class="search icon"></i>
                            搜索
                        </div>
                    </div>
                </div>
            </form>

            <table id="blogsTable" class="ui compact celled teal table">
                <thead>
                    <tr>
                        <th></th>
                        <th>标题</th>
                        <th>类型</th>
                        <th>推荐</th>
                        <th>更新时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <!-- <tbody>
                    <td>1</td>
                    <td>刻意联系清单</td>
                    <td>认知升级</td>
                    <td>是</td>
                    <td>2017-10-02 09:45</td>
                    <td>
                        <a href="#" class="ui mini teal basic button">编辑</a>
                        <a href="#" class="ui mini red basic button">删除</a>
                    </td>
                </tbody> -->
                <tfoot>
                    <tr>
                        <th colspan="6">
                            <div class="ui mini floated pagination menu">
                                <a id="lastPage"  class="icon item" style="display: none;">上一页</a>
                                <a id="nextPage"  class="icon item">下一页</a>
                            </div>
                            <a href="#" class="ui mini right floated  teal basic button">新增</a>
                        </th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
<!--详情页结束-->
    <!-- 底部footer -->
    <footer class="ui inverted vertical segment m-padded-tb-massive">
        <div class="ui container">
            <div class="ui inverted divided grid">
                <div class="three wide column">
                    <img src="./static/images/wechat.jpg" class="ui rounded image" alt="">
                </div>
                <div class="three wide column">
                    <h4 class="ui inverted header">最新博客</h4>
                    <div class="ui inverted link list">
                        <a href="#" class="item">用户故事</a>
                        <a href="#" class="item">用户故事</a>
                        <a href="#" class="item">用户故事</a>
                    </div>
                </div>
                <div class="three wide column">
                    <h4 class="ui inverted header">联系我</h4>
                    <div class="ui inverted link list">
                        <a href="#" class="item">Email:771736395@qq.com</a>
                        <a href="#" class="item">QQ:771736395</a>
                    </div>
                </div>
                <div class="seven wide column">
                    <h4 class="ui inverted header">满江红</h4>
                    <p class="m-text-thin m-text-spaced m-opacity-mini">
                        怒发冲冠，凭栏处、潇潇雨歇。抬望眼、仰天长啸，壮怀激烈。三十功名尘与土，八千里路云和月。莫等闲、白了少年头，空悲切。 靖康耻，犹未雪。臣子恨，何时灭。驾长车，踏破贺兰山缺。壮志饥餐胡虏肉，笑谈渴饮匈奴血。待从头、收拾旧山河，朝天阙。
                    </p>
                </div>
            </div>
            <div class="ui inverted section divider"></div>
            <p class="m-text-thin m-text-spaced m-opacity-mini" style="text-align: center;">Copyringt 2016-2017 Lirenmi Designed by Lirenmi</p>
        </div>
    </footer>


<!--    详情页新增-->
<script>
    var pageNum = 1;
    var pageSize = 3;
    var totalPage
    $(function(){
        /* checkToken(); */
        init();
    })
    $('.menu.toggle').click(function(){
        $('.m-item').toggleClass('m-mobile-hide');
    })
    $('.ui.dropdown').dropdown({
        on : 'hover'
    });
    function checkToken(){
    var token = localStorage.getItem("token");
    if(token==undefined){
        $(location).attr('href',loginPage);
    }else{
            $.ajax({
                type:"post",
                data:token,
                url:getTokenUrl,
                async:true,
                success:function(result){
                    /* console.log(result) */
                    if(result.status==201){
                        alert(result.msg)  
                    }
                    if(result.status==200){
                        $("body").css('display','block');
                    }else{
                        $(location).attr('href',loginPage);
                    }
                    
                }
            })
        }
    }
    function init(){
        getBlogsByPage();
        /* lastPage();
        nextPage(); */
        getTypeMenu();
        /* var url = window.location;
        if(url.toString().indexOf("?")>=0){
            checkStatus();
        } */
    }
    function getBlogsByPage(){
        $.ajax({
            type:"post",
            data:{
                "pageNum":pageNum,
                "pageSize":pageSize
            },
            url:getBlogsByPageUrl,
            success:function(result){
                if(result.data.content == undefined){
                    
                }else{
                    showBlogs(result.data.content);
                    totalPage = result.data.totalPages;
                }
            }
        })
    }
    /* 渲染table数据 */
    function showBlogs(content){
        console.log(content)
        //解析json字符串为json对象形式
        var obj = content;
        //动态拼接table
        var trStr = '';
        //循环遍历出json对象中的每一个数据并显示在对应的td中
        $("#blogsTable tbody").remove();
        for (var i = 0; i < obj.length; i++) {
            trStr += '<tbody>';
            trStr += '<td>' + obj[i].blogId + '</td>';//数据表的主键值
            trStr += '<td>' + obj[i].title + '</td>';// 博客标题
            trStr += '<td>' + obj[i].typeName + '</td>';// 博客类型
            trStr += '<td>' + obj[i].recommend + '</td>';// 博客是否推荐
            trStr += '<td>' + obj[i].updatetime + '</td>'; //博客更新时间
            trStr += '<td><div class="ui mini teal basic button" onclick="editClick('+obj[i].tagId+')">编辑</div>'
            trStr += '<div class="ui mini red basic button" onclick="deleteTagByTagId('+obj[i].tagId+')">删除</div></td>';  
            trStr += '</tbody>';                   
        }                   
        /* console.log(trStr) */
        $("#blogsTable").append(trStr);      
    }
    function getTypeMenu(){
        $.ajax({
            type:"post",
            url:getTypeByAllUrl,
            success:function(result){
                if(result.data == undefined){
                    alert(result.msg)
                }else{
                    showTypeMenu(result.data);
                }
            }
        });
    }
    /* 渲染下拉框 */
    function showTypeMenu(data){
        console.log(data)
        var divStr = ''
        /* $("#typeMenu").remove(); */
        $("#typeMenu").children().remove();
        for(var i = 0; i < data.length; i++){
            divStr += '<div class="item" data-value="'+i+'"onclick=typeMenuClick('+data[i].typeId+')>'+ data[i].typeName+'</div>';   
        }
        $("#typeMenu").append(divStr);
    }
    /* 分类菜单点击函数 */
    function typeMenuClick(typeId){
        $("[name=type]").val(typeId);
    }

    function search(){
        /* var typeId = $("[name=type]").val();
        var title = $("[name=title]").val();
        var recommend = $("[name=recommend]").is(':checked');
        console.log(typeId)
        console.log(title)
        console.log(recommend) */
        var recommend = $("[name=recommend]").is(':checked');
        if(recommend==true){
            recommend=1
        }else{
            recommend=0;
        }
        $.post({
            data:{
                "typeId":$("[name=type]").val(),
                "title":$("[name=title]").val(),
                "recommend":recommend
            },
            success:function(result){
                console.log(result)
            }
        })
    }
</script>

</body>

</html>